<%= turbo_frame_tag "user_rating_form" do %>
<%= form_with(model: [food_drink, rating], local: false, data: { turbo_frame: "user_rating_form" }) do |f| %>

<div class="mb-3 rating-wrapper" data-rating-form>
    <%= f.label :score, "Điểm (1–5)" %>
    <div class="d-flex gap-2 stars-container mt-1" id="star-rating">
        <% (1..5).each do |i| %>
        <span class="star" data-value="<%= i %>" style="font-size:1.8rem; color:<%= rating.score && rating.score >= i ? 'gold' : 'lightgray' %>; cursor:pointer;">
            ★
        </span>
        <% end %>
        <%= f.hidden_field :score, value: rating.score, data: { rating_input: true } %>
    </div>
    <span class="text-danger d-none mt-1" data-rating-error>! Vui lòng đánh giá</span>
</div>

<div class="mb-3">
    <%= f.label :comment, "Bình luận" %>
    <%= f.text_area :comment, rows: 3, class: "form-control", value: rating.comment %>
</div>

<div class="d-flex gap-2">
    <%= f.submit rating.persisted? ? "Cập nhật đánh giá" : "Gửi đánh giá",
              class: "btn btn-sm btn-primary",
              data: { disable_with: "Đang gửi..." } %>
</div>

<% end %>
<% end %>

<script>
    // Chọn sao
    document.querySelectorAll('#star-rating .star').forEach(star => {
        star.addEventListener('click', function() {
            const value = this.dataset.value;
            const input = this.closest('[data-rating-form]').querySelector('[data-rating-input]');
            input.value = value;

            this.closest('#star-rating').querySelectorAll('.star').forEach(s => {
                s.style.color = s.dataset.value <= value ? 'gold' : 'lightgray';
            });
        });
    });
</script>