<h1 class="text-center flex-grow-1 mb-0">Qu·∫£n l√Ω M√≥n ƒÉn & Th·ª©c u·ªëng</h1>

<!-- N√∫t ƒëi·ªÅu h∆∞·ªõng -->
<div class="mb-3">
    <%= link_to "Quay l·∫°i", admin_dashboard_path, class: "btn btn-secondary me-2" %>
    <%= link_to "T·∫•t c·∫£", admin_food_drinks_path, class: "btn btn-secondary me-2" %>
    <% Category.all.each do |category| %>
    <%= link_to category.name, admin_food_drinks_path(category_id: category.id), class: "btn btn-primary me-2" %>
    <% end %>
</div>

<!-- Thanh c√¥ng c·ª• -->
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
    <div class="mb-2">
        <%= link_to "Th√™m m·ªõi", new_admin_food_drink_path, class: "btn btn-success me-2" %>
        <%= link_to "L√†m m·ªõi", admin_food_drinks_path, class: "btn btn-outline-secondary" %>
    </div>

    <!-- Form t√¨m ki·∫øm & filter v·ªõi Turbo Frame -->
    <div class="d-flex align-items-center mb-2">
        <%= form_with url: admin_food_drinks_path, method: :get, local: true, class: "d-flex", data: { turbo_frame: "food_drinks_list" } do |f| %>
        <%= f.text_field :query, value: params[:query], placeholder: "üîç T√¨m ki·∫øm m√≥n ƒÉn ho·∫∑c th·ª©c u·ªëng...", class: "form-control me-2" %>
        <%= f.select :sort, options_for_select([
        ['M·ªõi nh·∫•t', 'newest'],
        ['T√™n A ‚Üí Z', 'name_asc'],
        ['T√™n Z ‚Üí A', 'name_desc'],
        ['Gi√° tƒÉng d·∫ßn', 'price_asc'],
        ['Gi√° gi·∫£m d·∫ßn', 'price_desc']
      ], params[:sort]), {}, class: "form-select me-2" %>
        <%= f.submit "L·ªçc", class: "btn btn-primary" %>
        <% end %>
    </div>
</div>

<!-- N√∫t ch·ªçn t·∫•t c·∫£ -->
<div class="mb-3">
    <button type="button" id="select_all_btn" class="btn btn-warning me-2">Ch·ªçn t·∫•t c·∫£ m√≥n ƒÉn</button>
</div>

<!-- Turbo Frame ch·ª©a b·∫£ng m√≥n ƒÉn -->
<%= turbo_frame_tag "food_drinks_list" do %>
<%= form_with url: bulk_delete_admin_food_drinks_path, method: :delete, local: true, data: { turbo_confirm: "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a c√°c m√≥n ƒë√£ ch·ªçn?" } do %>
<%= render partial: "list", locals: { food_drinks: @food_drinks } %>
<div class="mb-3">
    <%= submit_tag "X√≥a c√°c m√≥n ƒë√£ ch·ªçn", class: "btn btn-danger" %>
</div>
<% end %>
<% end %>

<% if @food_drinks.empty? %>
<p class="text-center text-muted mt-3">Kh√¥ng t√¨m th·∫•y m√≥n ƒÉn/th·ª©c u·ªëng n√†o ph√π h·ª£p.</p>
<% end %>

<!-- JS ch·ªçn/b·ªè ch·ªçn t·∫•t c·∫£ -->
<script>
    document.addEventListener("turbo:load", () => {
        const selectAllBtn = document.querySelector("#select_all_btn");
        const checkboxes = document.querySelectorAll(".food-drink-checkbox");

        if (selectAllBtn) {
            let allSelected = false;
            selectAllBtn.addEventListener("click", () => {
                allSelected = !allSelected;
                checkboxes.forEach(cb => cb.checked = allSelected);
                selectAllBtn.textContent = allSelected ? "B·ªè ch·ªçn t·∫•t c·∫£" : "Ch·ªçn t·∫•t c·∫£ m√≥n ƒÉn";
            });
        }
    });
    document.addEventListener("turbo:load", () => {
        const searchInput = document.querySelector('input[name="query"]');
        if (!searchInput) return;

        let timeout = null;

        searchInput.addEventListener("input", () => {
            clearTimeout(timeout);

            timeout = setTimeout(() => {
                const form = searchInput.closest("form");

                // Submit form b·∫±ng Turbo (ch·ªâ update frame)
                Turbo.renderStreamMessage(new URLSearchParams(new FormData(form)).toString());
                form.requestSubmit(); // submit form m√† kh√¥ng reload page
            }, 300); // 300ms debounce
        });

        // Ch·ªçn / b·ªè ch·ªçn t·∫•t c·∫£
        const selectAllBtn = document.querySelector("#select_all_btn");
        const checkboxes = document.querySelectorAll(".food-drink-checkbox");

        if (selectAllBtn) {
            let allSelected = false;
            selectAllBtn.addEventListener("click", () => {
                allSelected = !allSelected;
                checkboxes.forEach(cb => cb.checked = allSelected);
                selectAllBtn.textContent = allSelected ? "B·ªè ch·ªçn t·∫•t c·∫£" : "Ch·ªçn t·∫•t c·∫£ m√≥n ƒÉn";
            });
        }
    });
</script>