<!-- Header: n√∫t quay l·∫°i + title -->
<div class="food-drinks-header mb-3 d-flex align-items-center">
    <div class="back-button">
        <%= link_to "Quay l·∫°i", admin_dashboard_path, class: "btn btn-secondary" %>
    </div>
    <h1 class="flex-grow-1 text-center mb-0">Qu·∫£n l√Ω M√≥n ƒÉn & Th·ª©c u·ªëng</h1>
</div>

<!-- N√∫t category -->
<div class="category-buttons mb-3">
    <%= link_to "T·∫•t c·∫£", admin_food_drinks_path, class: "btn btn-secondary me-2 mb-2" %>
    <% Category.all.each do |category| %>
    <%= link_to category.name, admin_food_drinks_path(category_id: category.id), class: "btn btn-primary me-2 mb-2" %>
    <% end %>
</div>

<!-- Toolbar ch√≠nh -->
<div class="toolbar-wrapper mb-3">
    <!-- Left actions -->
    <div class="left-actions">
        <button type="button" id="select_all_btn" class="btn btn-warning">Ch·ªçn t·∫•t c·∫£ m√≥n ƒÉn</button>
        <div class="actions">
            <%= link_to "Th√™m m·ªõi", new_admin_food_drink_path, class: "btn btn-success" %>
            <%= link_to "L√†m m·ªõi", admin_food_drinks_path, class: "btn btn-outline-secondary" %>
        </div>
    </div>

    <!-- Filter form -->
    <div class="filter-form">
        <%= form_with url: admin_food_drinks_path, method: :get, local: false, data: { turbo_frame: "food_drinks_list" }, class: "d-flex align-items-center gap-2" do |f| %>
        <%= f.text_field :query, value: params[:query], placeholder: "üîç T√¨m ki·∫øm...", class: "form-control" %>
        <%= f.select :sort, options_for_select([
        ['M·ªõi nh·∫•t', 'newest'],
        ['T√™n A ‚Üí Z', 'name_asc'],
        ['T√™n Z ‚Üí A', 'name_desc'],
        ['Gi√° tƒÉng d·∫ßn', 'price_asc'],
        ['Gi√° gi·∫£m d·∫ßn', 'price_desc']
      ], params[:sort]), {}, class: "form-select" %>
        <%= f.submit "L·ªçc", class: "btn btn-primary" %>
        <% end %>
    </div>
</div>


<!-- Turbo Frame ch·ª©a b·∫£ng m√≥n ƒÉn full m√†n h√¨nh -->
<%= turbo_frame_tag "food_drinks_list" do %>
<%= form_with url: bulk_delete_admin_food_drinks_path, method: :delete, local: true, data: { turbo_confirm: "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a c√°c m√≥n ƒë√£ ch·ªçn?" } do %>

<div class="food-drinks-table table-responsive mb-3">
    <%= render partial: "list", locals: { food_drinks: @food_drinks } %>
</div>

<div class="mb-3">
    <%= submit_tag "X√≥a c√°c m√≥n ƒë√£ ch·ªçn", class: "btn btn-danger" %>
</div>

<% end %>

<% if @food_drinks.empty? %>
<p class="text-center text-muted mt-3">Kh√¥ng t√¨m th·∫•y m√≥n ƒÉn/th·ª©c u·ªëng n√†o ph√π h·ª£p.</p>
<% end %>
<% end %>


<!-- JS ch·ªçn/b·ªè ch·ªçn t·∫•t c·∫£ + Auto search -->
<script>
    document.addEventListener("turbo:load", () => {
        // Ch·ªçn / b·ªè ch·ªçn t·∫•t c·∫£
        const selectAllBtn = document.querySelector("#select_all_btn");
        if (selectAllBtn) {
            let allSelected = false;
            selectAllBtn.addEventListener("click", () => {
                allSelected = !allSelected;
                document.querySelectorAll(".food-drink-checkbox").forEach(cb => cb.checked = allSelected);
                selectAllBtn.textContent = allSelected ? "B·ªè ch·ªçn t·∫•t c·∫£" : "Ch·ªçn t·∫•t c·∫£ m√≥n ƒÉn";
            });
        }

        // Auto search
        const searchInput = document.querySelector('input[name="query"]');
        if (searchInput) {
            let timeout = null;
            searchInput.addEventListener("input", () => {
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    const form = searchInput.closest("form");
                    form.requestSubmit(); // submit form b·∫±ng Turbo, update frame food_drinks_list
                }, 300); // 300ms debounce
            });
        }
    });
</script>