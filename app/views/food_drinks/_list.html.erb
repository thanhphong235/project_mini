<div class="row mt-3 g-3">
    <% food_drinks.each do |fd| %>
    <div class="col-sm-6 col-md-4 col-lg-3">
        <div class="card h-100 shadow-sm bg-dark text-light">
            <%# Hình ảnh sản phẩm %>
            <% if fd.image.attached? %>
            <%= image_tag fd.image, class: "card-img-top", style: "height: 200px; object-fit: cover;" %>
            <% else %>
            <div class="bg-secondary text-white d-flex align-items-center justify-content-center" style="height: 200px;">
                Không có ảnh
            </div>
            <% end %>
            <div class="card-body d-flex flex-column">
                <%# Tên sản phẩm %>
                <h5 class="card-title">
                    <a href="<%= food_drink_path(fd) %>" class="text-light text-decoration-none" data-turbo-frame="_top">
                        <%= fd.name %>
                    </a>
                </h5>

                <%# Giá %>
                <p class="card-text mb-1">
                    <strong>Giá:</strong> <%= number_to_currency(fd.price, unit: "₫", precision: 0, delimiter: ".") %>
                </p>

                <%# Danh mục %>
                <p class="card-text mb-1">
                    <strong>Danh mục:</strong> <%= fd.category&.name || "Chưa phân loại" %>
                </p>

                <%# Số lượng còn %>
                <p class="card-text mb-2">
                    <strong>Số lượng còn:</strong>
                    <turbo-frame id="food_drink_<%= fd.id %>_stock">
                        <%= fd.stock > 0 ? fd.stock : "Hết hàng" %>
                    </turbo-frame>
                </p>

                <%# Hiển thị đánh giá sao %>
                <p class="card-text mb-1">
                    <strong>Đánh giá:</strong>

                    <% avg = fd.average_rating %>
                    <% full_stars = avg.floor %>
                    <% half_star = (avg - full_stars >= 0.5) %>

                    <% full_stars.times do %>
                    ⭐
                    <% end %>

                    <% if half_star %>
                    ✩
                    <% end %>

                    <% (5 - full_stars - (half_star ? 1 : 0)).times do %>
                    ☆
                    <% end %>

                    (<%= avg %>/5)
                </p>


                <%# Nút Xem chi tiết và Thêm vào giỏ %>
                <div class="mt-auto d-flex gap-2">
                    <%= link_to "Xem chi tiết", food_drink_path(fd), class: "btn btn-sm btn-outline-primary flex-grow-1", data: { turbo_frame: "_top" } %>

                    <%= turbo_frame_tag "food_drink_#{fd.id}_button" do %>
                    <% if fd.stock > 0 %>
                    <%= button_to "Thêm vào giỏ", cart_items_path, method: :post, params: { food_drink_id: fd.id, quantity: 1 }, class: "btn btn-sm btn-primary flex-grow-1" %>
                    <% else %>
                    <button class="btn btn-sm btn-secondary flex-grow-1" disabled>Hết hàng</button>
                    <% end %>
                    <% end %>
                </div>
            </div>
        </div>
    </div>
    <% end %>
</div>