<div class="order-statistics container py-4">

    <!-- HEADER -->
    <div class="stats-header d-flex justify-content-between align-items-center mb-4">

        <h1 class="page-title text-center flex-grow-1 mb-0 fw-bold">
            Th·ªëng k√™ ƒë∆°n h√†ng ‚Äî <%= @month %>/<%= @year %>
        </h1>

        <div style="width:140px;"></div>
    </div>

    <!-- ACTION BAR -->
    <div class="action-bar d-flex justify-content-between align-items-center flex-wrap gap-3 mb-4">

        <%= button_to "üì© G·ª≠i b√°o c√°o qua email",
            admin_send_monthly_report_path(month: @month, year: @year),
            method: :post,
            class: "btn btn-success fw-semibold shadow-sm",
            data: { confirm: "G·ª≠i b√°o c√°o th·ªëng k√™ th√°ng n√†y qua email?" } %>

        <!-- FORM L·ªåC -->
        <%= form_with url: admin_order_statistics_path,
                      method: :get, local: true,
                      class: "filter-form d-flex gap-3 align-items-center flex-wrap p-3 rounded-3 shadow-sm" do %>

        <div class="d-flex align-items-center gap-2">
            <label class="fw-semibold">Th√°ng:</label>
            <%= select_tag :month, options_for_select(1..12, @month), class: "form-select form-dark" %>
        </div>

        <div class="d-flex align-items-center gap-2">
            <label class="fw-semibold">NƒÉm:</label>
            <%= select_tag :year,
                    options_for_select((2023..Time.current.year).to_a.reverse, @year),
                    class: "form-select form-dark" %>
        </div>

        <%= submit_tag "Xem", class: "btn btn-primary fw-semibold" %>
        <% end %>

    </div>

    <!-- SUMMARY -->
    <div class="summary d-flex flex-wrap gap-3 mb-4">

        <div class="summary-card flex-grow-1 shadow-sm">
            <div class="label">T·ªïng s·ªë ƒë∆°n</div>
            <div class="value"><%= @total_orders %></div>
        </div>

        <div class="summary-card flex-grow-1 shadow-sm">
            <div class="label">T·ªïng doanh thu</div>
            <div class="value text-success">
                <%= number_to_currency(@total_revenue, unit: "‚Ç´") %>
            </div>
        </div>

    </div>

    <!-- TABLE -->
    <div class="table-responsive shadow-sm">
        <table class="table table-dark table-bordered table-hover align-middle text-center mb-0 rounded-3 overflow-hidden">
            <thead class="table-dark-header">
                <tr>
                    <th>#</th>
                    <th>Ng∆∞·ªùi ƒë·∫∑t</th>
                    <th>T·ªïng ti·ªÅn</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Ng√†y t·∫°o</th>
                </tr>
            </thead>

            <tbody>
                <% @orders.each_with_index do |order, index| %>
                <tr>
                    <td class="fw-semibold"><%= index + 1 %></td>

                    <td class="text-start">
                        <%= order.user&.name || order.user&.email || "N/A" %>
                    </td>

                    <td class="price-cell">
                        <%= number_to_currency(order.total_price, unit: "‚Ç´") %>
                    </td>

                    <td>
                        <%= render "admin/orders/status_badge", order: order %>
                    </td>

                    <td><%= order.created_at.strftime("%d/%m/%Y %H:%M") %></td>
                </tr>
                <% end %>
            </tbody>
        </table>
    </div>

</div>

<!-- DARK MODE CSS -->
<style>
    body {
        background-color: #121212 !important;
        color: #f1f1f1 !important;
    }

    .order-statistics {
        background: #1c1c1c;
        border-radius: 14px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.45);
    }

    .page-title {
        color: #ffffff;
        font-size: 1.6rem;
    }

    /* Filter Form */
    .filter-form {
        background: #222;
        border: 1px solid #333;
    }

    .form-dark {
        background: #333 !important;
        color: #fff !important;
        border: 1px solid #555 !important;
    }

    /* SUMMARY */
    .summary-card {
        background: #181818;
        padding: 1.2rem 1.5rem;
        border-radius: 14px;
        min-width: 220px;
    }

    .summary-card .label {
        color: #bbbbbb;
        font-size: 0.95rem;
    }

    .summary-card .value {
        font-size: 1.6rem;
        font-weight: 700;
    }

    /* TABLE */
    .table-dark-header th {
        background: #111 !important;
        color: #f1f1f1 !important;
        font-weight: 700;
    }

    .price-cell {
        font-variant-numeric: tabular-nums;
        font-weight: 600;
    }

    /* BADGES */
    .status-badge {
        padding: 5px 12px;
        border-radius: 12px;
        font-weight: 600;
        font-size: .9rem;
    }

    .status-badge.pending {
        background: #ffc107;
        color: #212529;
    }

    .status-badge.confirmed {
        background: #0d6efd;
    }

    .status-badge.delivering {
        background: #17a2b8;
    }

    .status-badge.completed {
        background: #198754;
    }

    .status-badge.cancelled {
        background: #dc3545;
    }

    @media (max-width: 768px) {
        .page-title {
            font-size: 1.3rem;
        }

        table {
            font-size: .85rem;
        }
    }

    .table,
    .table-bordered,
    .table-bordered> :not(caption)>*>* {
        border-color: #333 !important;
    }

    .table {
        background: #1a1a1a !important;
        border: 2px solid #222 !important;
    }

    .table td,
    .table th {
        background: #1a1a1a !important;
        color: #e6e6e6 !important;
    }

    .table-responsive {
        background: transparent !important;
        border: none !important;
    }

    .table-responsive .table {
        border-radius: 0 !important;
    }
</style>