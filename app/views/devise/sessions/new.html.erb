<% provide(:title, "Log in") %>

<div class="row justify-content-center mt-5">
    <div class="col-md-5">
        <div class="card shadow-lg border-0 rounded-4 p-4">

            <!-- Header -->
            <div class="position-relative mb-4">
                <!-- Nút quay lại ở góc trái -->
                <%= link_to root_path, class: "btn btn-outline-secondary btn-sm position-absolute start-0" do %>
                <i class="bi bi-arrow-left"></i>
                <% end %>

                <!-- Tiêu đề & mô tả căn giữa -->
                <div class="text-center">
                    <h2 class="fw-bold mb-0">Welcome Back</h2>
                    <p class="text-muted mb-0">Log in to continue</p>
                </div>
            </div>



            <!-- Flash -->
            <%
=begin%>
            <% if alert.present? %>
            <div class="alert alert-danger"><%= alert %></div>
            <% elsif notice.present? %>
            <div class="alert alert-success"><%= notice %></div>
            <% end %>
            <%
=end%>

            <%= form_for(resource,
          as: resource_name,
          url: session_path(resource_name),
          html: {
            class: "needs-validation",
            data: {
                    turbo:false,
                social_accounts: {
                google: ["google_user@example.com", "test_google@gmail.com"],
                facebook: ["fb_user@example.com"],
                twitter: ["tw_user@example.com"]
              }.to_json
            }
          }
        ) do |f| %>

            <!-- Email -->
            <div class="mb-3">
                <%= f.label :email, class: "form-label fw-semibold" %>
                <%= f.email_field :email,
                required: true,
                autofocus: true,
                class: "form-control form-control-lg rounded-3",
                placeholder: "Enter your email" %>
            </div>

            <!-- Password -->
            <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <%= f.label :password, class: "form-label fw-semibold" %>
                </div>

                <div class="input-group input-group-lg">
                    <%= f.password_field :password,
                  required: true,
                  class: "form-control rounded-start-3",
                  placeholder: "Enter your password",
                  id: "password-field" %>

                    <button class="btn btn-outline-secondary rounded-end-3" type="button" id="toggle-password">
                        <i class="bi bi-eye"></i>
                    </button>
                </div>
            </div>

            <!-- Remember + Forgot -->
            <div class="form-check d-flex justify-content-between align-items-center mb-3">
                <div>
                    <%= f.check_box :remember_me, class: "form-check-input" %>
                    <%= f.label :remember_me, "Remember me", class: "form-check-label ms-1" %>
                </div>
                <%= link_to "Forgot password?", new_user_password_path, class: "small text-primary" %>
            </div>

            <!-- Submit -->
            <div class="d-grid mb-3">
                <%= f.submit "Log in",
                class: "btn btn-primary btn-lg rounded-3 w-100 d-flex align-items-center justify-content-center gap-2" %>
            </div>

            <% end %>

            <!-- Divider -->
            <div class="position-relative text-center my-4">
                <hr>
                <span class="position-absolute top-50 start-50 translate-middle px-3 bg-white text-muted small">
                    OR
                </span>
            </div>

            <!-- Social login buttons -->
            <div class="d-grid gap-3 mb-2">

                <%= button_to user_google_oauth2_omniauth_authorize_path,
            method: :post,
            form: { data: { turbo: false } },
            class: "btn btn-light border btn-lg rounded-3 w-100 d-flex align-items-center justify-content-center gap-2" do %>
                <i class="bi bi-google fs-5"></i> Sign in with Google
                <% end %>

                <%= button_to user_facebook_omniauth_authorize_path,
            method: :post,
            form: { data: { turbo: false } },
            class: "btn btn-primary btn-lg rounded-3 w-100 d-flex align-items-center justify-content-center gap-2" do %>
                <i class="bi bi-facebook fs-5"></i> Sign in with Facebook
                <% end %>

                <%= button_to user_twitter_omniauth_authorize_path,
            method: :post,
            form: { data: { turbo: false } },
            class: "btn btn-info text-white btn-lg rounded-3 w-100 d-flex align-items-center justify-content-center gap-2" do %>
                <i class="bi bi-twitter fs-5"></i> Sign in with Twitter
                <% end %>

            </div>

            <!-- Signup -->
            <p class="text-center mt-3">
                New user?
                <%= link_to "Sign up now!", new_user_registration_path, class: "fw-semibold" %>
            </p>

        </div>
    </div>
</div>

<script>
    document.addEventListener("turbo:load", () => {
        const btn = document.getElementById("toggle-password");
        const pw = document.getElementById("password-field");
        btn.addEventListener("click", () => {
            const icon = btn.querySelector("i");
            const isHidden = pw.type === "password";
            pw.type = isHidden ? "text" : "password";
            icon.classList.toggle("bi-eye", !isHidden);
            icon.classList.toggle("bi-eye-slash", isHidden);
        });
    });
</script>