<%= turbo_frame_tag "order_show_#{@order.id}" do %>

<!-- Flash messages -->
<div id="flash_messages"></div>

<div class="order-glass-card">

    <!-- HEADER -->
    <div class="order-glass-header">
        <%= link_to "Quay lại", admin_orders_path, class: "btn-back-glass", data: { turbo: false } %>
        <h1 class="order-glass-title">Chi tiết đơn hàng #<%= @order.id %></h1>
        <div class="header-placeholder-glass"></div>
    </div>

    <!-- INFO SECTION -->
    <div class="glass-info-box">
        <div class="glass-info-row">
            <div class="label-glass">Người đặt</div>
            <div class="value-glass"><%= @order.user&.name || @order.user&.email %></div>
        </div>

        <div class="glass-info-row">
            <div class="label-glass">Ngày đặt</div>
            <div class="value-glass"><%= @order.created_at.strftime("%d/%m/%Y %H:%M") %></div>
        </div>

        <div class="glass-info-row">
            <div class="label-glass">Tổng tiền</div>
            <div class="value-glass"><%= number_to_currency(@order.total_price, unit: "₫") %></div>
        </div>

        <div class="glass-info-row">
            <div class="label-glass">Trạng thái</div>
            <div class="value-glass">
                <%= turbo_frame_tag "order_status_#{@order.id}" do %>
                <%= render "status_badge", order: @order %>
                <% end %>
            </div>
        </div>
    </div>

    <!-- DANH SÁCH SẢN PHẨM -->
    <h3 class="glass-section-title">Danh sách sản phẩm</h3>
    <div class="glass-table-wrapper">
        <table class="table glass-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Tên sản phẩm</th>
                    <th>Số lượng</th>
                    <th>Đơn giá</th>
                    <th>Thành tiền</th>
                </tr>
            </thead>
            <tbody>
                <% @order.order_items.each_with_index do |item, index| %>
                <tr>
                    <td><%= index + 1 %></td>
                    <td><%= item.food_drink.name %></td>
                    <td><%= item.quantity %></td>
                    <td><%= number_to_currency(item.price, unit: "₫") %></td>
                    <td><%= number_to_currency(item.price * item.quantity, unit: "₫") %></td>
                </tr>
                <% end %>
            </tbody>
        </table>
    </div>

    <!-- UPDATE FORM -->
    <h3 class="glass-section-title">Cập nhật trạng thái</h3>
    <%= form_with(model: [:admin, @order], method: :patch, local: false, class: "glass-form") do |f| %>
    <div class="glass-info-row mb-4">
        <div class="label-glass">Trạng thái</div>
        <div class="value-glass">
            <%= f.select :status,
              Order.statuses.keys.map { |key| [Order.new(status: key).status_human, key] },
              { selected: @order.status },
              class: "select-glass",
              disabled: @order.cancelled? %>
        </div>
    </div>

    <div class="form-actions-glass">
        <%= f.submit "Cập nhật", class: "btn-save-glass", disabled: @order.cancelled? %>

        <!-- Nút XÓA -->
        <%= render "delete_button", order: @order %>
    </div>
    <% end %>

</div>
<% end %>


<!-- AUTO-HIDE FLASH -->
<script>
    document.addEventListener("turbo:load", () => {
        const flashes = document.querySelectorAll("#flash_messages .alert");
        flashes.forEach(flash => {
            setTimeout(() => flash.remove(), 4000);
        });
    });
</script>


<style>
    /* CARD GLASS */
    .order-glass-card {
        background: rgba(15, 15, 15, 0.55);
        border-radius: 28px;
        padding: 45px 50px;
        backdrop-filter: blur(18px) saturate(180%);
        -webkit-backdrop-filter: blur(18px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.65);
        max-width: 880px;
        margin: 40px auto;
        color: #fff;
    }

    .order-glass-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 32px;
    }

    .order-glass-title {
        flex-grow: 1;
        text-align: center;
        font-size: 2rem;
        font-weight: 800;
        color: #fff;
    }

    .header-placeholder-glass {
        width: 120px;
    }

    .btn-back-glass {
        padding: 10px 22px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #f5f5f5;
        transition: .25s;
    }

    .btn-back-glass:hover {
        background: rgba(255, 255, 255, 0.25);
    }

    .glass-info-box {
        display: flex;
        flex-direction: column;
        margin-bottom: 25px;
    }

    .glass-info-row {
        display: grid;
        grid-template-columns: 160px 1fr;
        gap: 20px;
        padding: 14px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.12);
    }

    .label-glass {
        font-size: 0.9rem;
        font-weight: 600;
        color: #bbb;
        text-transform: uppercase;
    }

    .value-glass {
        font-size: 1.05rem;
        font-weight: 500;
        color: #fff;
    }

    .glass-section-title {
        color: #fff;
        font-weight: 700;
        margin: 30px 0 15px;
        font-size: 1.3rem;
    }

    .glass-table-wrapper {
        margin-bottom: 30px;
        border-radius: 18px;
        overflow: hidden;
    }

    .glass-table {
        --bs-table-bg: transparent !important;
        --bs-table-striped-bg: transparent !important;
        --bs-table-hover-bg: rgba(255, 255, 255, 0.06) !important;
        background: rgba(30, 30, 30, 0.35) !important;
        backdrop-filter: blur(12px);
        color: #fff !important;
    }

    .glass-table thead {
        background: rgba(40, 40, 40, 0.55) !important;
    }

    .glass-table thead th {
        color: #f1f1f1 !important;
        font-weight: 700;
        border-color: rgba(255, 255, 255, 0.18) !important;
    }

    .glass-table tbody tr {
        background: rgba(30, 30, 30, 0.25) !important;
    }

    .glass-table tbody tr:hover {
        background: rgba(255, 255, 255, 0.06) !important;
    }

    .glass-table td,
    .glass-table th {
        border-color: rgba(255, 255, 255, 0.15) !important;
        color: #fff !important;
    }

    .select-glass {
        padding: 10px 14px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        background: rgba(40, 40, 40, 0.6);
        color: white;
        width: 100%;
        transition: .25s;
    }

    .select-glass:focus {
        border-color: #4f7cff;
        box-shadow: 0 0 0 0.2rem rgba(79, 124, 255, 0.35);
    }

    .form-actions-glass {
        display: flex;
        gap: 15px;
        margin-top: 15px;
    }

    .btn-save-glass {
        padding: 12px 28px;
        background: linear-gradient(135deg, #5f89ff, #3357ff);
        color: white;
        border-radius: 14px;
        font-weight: 700;
        border: none;
        flex: 1;
        transition: .25s;
    }

    .btn-save-glass:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 22px rgba(52, 98, 248, 0.45);
    }

    .btn-delete-glass {
        padding: 12px 28px;
        border-radius: 14px;
        border: 1px solid rgba(255, 100, 100, 0.45);
        color: #ff6b6b;
        background: rgba(255, 255, 255, 0.1);
        font-weight: 600;
        flex: 1;
        transition: .25s;
    }

    .btn-delete-glass:hover {
        background: #ff4d4d;
        color: white !important;
        box-shadow: 0 4px 14px rgba(255, 0, 0, 0.45);
    }

    .btn-delete-glass.disabled {
        opacity: 0.4;
        cursor: not-allowed;
        border-style: dashed;
    }
</style>