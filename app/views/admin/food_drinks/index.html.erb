<h1 class="text-center flex-grow-1 mb-0">Qu·∫£n l√Ω M√≥n ƒÉn & Th·ª©c u·ªëng</h1>

<!-- N√∫t ƒëi·ªÅu h∆∞·ªõng -->
<div class="mb-3">
    <%= link_to "Quay l·∫°i", admin_dashboard_path, class: "btn btn-secondary me-2" %>
    <%= link_to "T·∫•t c·∫£", admin_food_drinks_path, class: "btn btn-secondary me-2" %>

    <% Category.all.each do |category| %>
    <%= link_to category.name, admin_food_drinks_path(category_id: category.id), class: "btn btn-primary me-2" %>
    <% end %>
</div>

<!-- Thanh c√¥ng c·ª•: th√™m m·ªõi, t√¨m ki·∫øm, s·∫Øp x·∫øp -->
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
    <div class="mb-2">
        <%= link_to "Th√™m m·ªõi", new_admin_food_drink_path, class: "btn btn-success me-2" %>
        <%= link_to "L√†m m·ªõi", admin_food_drinks_path, class: "btn btn-outline-secondary" %>
    </div>

    <div class="d-flex align-items-center mb-2">
        <%= form_with url: admin_food_drinks_path, method: :get, local: true, class: "d-flex" do |f| %>
        <%= f.text_field :query, value: params[:query], placeholder: "üîç T√¨m ki·∫øm m√≥n ƒÉn ho·∫∑c th·ª©c u·ªëng...", class: "form-control me-2" %>
        <%= f.select :sort, options_for_select([
          ['M·ªõi nh·∫•t', 'newest'],
          ['T√™n A ‚Üí Z', 'name_asc'],
          ['T√™n Z ‚Üí A', 'name_desc'],
          ['Gi√° tƒÉng d·∫ßn', 'price_asc'],
          ['Gi√° gi·∫£m d·∫ßn', 'price_desc']
        ], params[:sort]), {}, class: "form-select me-2" %>
        <%= f.submit "L·ªçc", class: "btn btn-primary" %>
        <% end %>
    </div>
</div>

<!-- N√∫t ch·ªçn t·∫•t c·∫£ -->
<div class="mb-3">
    <button type="button" id="select_all_btn" class="btn btn-warning me-2">Ch·ªçn t·∫•t c·∫£ m√≥n ƒÉn</button>
</div>

<!-- Form x√≥a nhi·ªÅu m√≥n -->
<%= form_with url: bulk_delete_admin_food_drinks_path, method: :delete, local: true, data: { turbo_confirm: "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a c√°c m√≥n ƒë√£ ch·ªçn?" } do %>
<table class="table table-striped align-middle">
    <thead>
        <tr>
            <th></th>
            <th>#</th>
            <th>T√™n</th>
            <th>Gi√°</th>
            <th>Category</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>M√¥ t·∫£</th>
            <th>·∫¢nh</th>
            <th>H√†nh ƒë·ªông</th>
        </tr>
    </thead>
    <tbody>
        <% @food_drinks.each_with_index do |fd, index| %>
        <tr id="food_drink_<%= fd.id %>">
            <td>
                <%= check_box_tag "food_drink[food_drink_ids][]", fd.id, false, class: "form-check-input food-drink-checkbox big-checkbox" %>
            </td>
            <td><%= index + 1 %></td>
            <td><%= fd.name %></td>
            <td><%= number_to_currency(fd.price, unit: "‚Ç´") %></td>
            <td><%= fd.category&.name || "Ch∆∞a ph√¢n lo·∫°i" %></td>

            <!-- Inline c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng -->
            <td>
                <%= form_with model: [:admin, fd], method: :patch, local: true do |sf| %>
                <div class="d-flex">
                    <%= sf.number_field :stock, value: fd.stock, class: "form-control form-control-sm me-1", min: 0 %>
                    <%= sf.submit "C·∫≠p nh·∫≠t", class: "btn btn-sm btn-primary" %>
                </div>
                <% end %>
            </td>

            <td><%= truncate(fd.description, length: 50) %></td>

            <td>
                <% if fd.image.attached? %>
                <%= image_tag fd.image, width: 80, height: 80, alt: fd.name, class: "rounded shadow-sm" %>
                <% else %>
                <span class="text-muted">Kh√¥ng c√≥ ·∫£nh</span>
                <% end %>
            </td>

            <td>
                <%= link_to "S·ª≠a", edit_admin_food_drink_path(fd), class: "btn btn-warning btn-sm me-1" %>
                <%= link_to "X√≥a", admin_food_drink_path(fd),
                        data: { turbo_method: :delete,
                                turbo_confirm: fd.order_items.any? ? 
                                  "‚ö†Ô∏è M√≥n ƒÉn n√†y ƒëang c√≥ ƒë∆°n h√†ng. B·∫°n ch·∫Øc ch·∫Øn mu·ªën xo√°?" :
                                  "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° m√≥n ƒÉn/th·ª©c u·ªëng n√†y?" },
                        class: "btn btn-danger btn-sm" %>
            </td>
        </tr>
        <% end %>
    </tbody>
</table>

<div class="mb-3">
    <%= submit_tag "X√≥a c√°c m√≥n ƒë√£ ch·ªçn", class: "btn btn-danger" %>
</div>
<% end %>

<% if @food_drinks.empty? %>
<p class="text-center text-muted mt-3">Kh√¥ng t√¨m th·∫•y m√≥n ƒÉn/th·ª©c u·ªëng n√†o ph√π h·ª£p.</p>
<% end %>

<!-- JS ch·ªçn/b·ªè ch·ªçn t·∫•t c·∫£ -->
<script>
    document.addEventListener("turbo:load", () => {
        const selectAllBtn = document.querySelector("#select_all_btn");
        const checkboxes = document.querySelectorAll(".food-drink-checkbox");

        if (selectAllBtn) {
            let allSelected = false;

            selectAllBtn.addEventListener("click", () => {
                allSelected = !allSelected;
                checkboxes.forEach(cb => cb.checked = allSelected);
                selectAllBtn.textContent = allSelected ? "B·ªè ch·ªçn t·∫•t c·∫£" : "Ch·ªçn t·∫•t c·∫£ m√≥n ƒÉn";
            });
        }
    });
</script>