<% provide(:title, "Log in") %>

<div class="row justify-content-center mt-5">
    <div class="col-md-5">
        <div class="card shadow-lg border-0 rounded-4 p-4">
            <div class="text-center mb-4">
                <h2 class="fw-bold">Welcome Back</h2>
                <p class="text-muted">Log in to continue</p>
            </div>

            <!-- Hiển thị lỗi -->
            <% if alert %>
            <div class="alert alert-danger"><%= alert %></div>
            <% elsif notice %>
            <div class="alert alert-success"><%= notice %></div>
            <% end %>

            <%= form_for(resource, as: resource_name, url: session_path(resource_name),
        html: { 
          class: "needs-validation",
          data: { social_accounts: {
            google: ["google_user@example.com", "test_google@gmail.com"],
            facebook: ["fb_user@example.com"],
            twitter: ["tw_user@example.com"]
          }.to_json }
        }) do |f| %>

            <!-- Email -->
            <div class="mb-3">
                <%= f.label :email, class: "form-label fw-semibold" %>
                <%= f.email_field :email,
                required: true,
                autofocus: true,
                class: "form-control form-control-lg rounded-3",
                placeholder: "Enter your email" %>
            </div>

            <!-- Password -->
            <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <%= f.label :password, class: "form-label fw-semibold" %>
                </div>

                <div class="input-group input-group-lg">
                    <%= f.password_field :password,
                  required: true,
                  class: "form-control rounded-start-3",
                  placeholder: "Enter your password",
                  id: "password-field" %>
                    <button class="btn btn-outline-secondary rounded-end-3" type="button" id="toggle-password">
                        <i class="bi bi-eye"></i>
                    </button>
                </div>
            </div>

            <!-- Remember me -->
            <div class="form-check mb-3">
                <%= f.check_box :remember_me, class: "form-check-input" %>
                <%= f.label :remember_me, "Remember me", class: "form-check-label" %>
                <%= link_to "Forgot password?", new_user_password_path, class: "small text-primary" %>
            </div>

            <!-- Submit -->
            <div class="d-grid mb-3">
                <%= f.submit "Log in", class: "btn btn-primary btn-lg rounded-3 w-100 d-flex align-items-center justify-content-center gap-2" %>
            </div>
            <% end %>

            <!-- Divider -->
            <div class="position-relative text-center my-4">
                <hr>
                <span class="position-absolute top-50 start-50 translate-middle px-3 bg-white text-muted small">
                    OR
                </span>
            </div>

            <!-- Social login -->
            <div class="d-grid gap-3 mb-2">

                <%= button_to user_google_oauth2_omniauth_authorize_path,
                    method: :post,
                    class: "btn btn-light border btn-lg rounded-3 w-100 d-flex align-items-center justify-content-center gap-2",
                    form: { data: { turbo: false } } do %>
                <i class="bi bi-google fs-5"></i> Sign in with Google
                <% end %>

                <%= button_to user_facebook_omniauth_authorize_path,
                    method: :post,
                    class: "btn btn-primary btn-lg rounded-3 w-100 d-flex align-items-center justify-content-center gap-2",
                    form: { data: { turbo: false } } do %>
                <i class="bi bi-facebook fs-5"></i> Sign in with Facebook
                <% end %>

                <%= button_to user_twitter_omniauth_authorize_path,
                    method: :post,
                    class: "btn btn-info text-white btn-lg rounded-3 w-100 d-flex align-items-center justify-content-center gap-2",
                    form: { data: { turbo: false } } do %>
                <i class="bi bi-twitter fs-5"></i> Sign in with Twitter
                <% end %>

            </div>


            <p class="text-center mt-3">
                New user?
                <%= link_to "Sign up now!", new_user_registration_path, class: "fw-semibold" %>
            </p>
        </div>
    </div>
</div>

<!-- Eye toggle -->
<script>
    document.addEventListener("turbo:load", () => {
        const btn = document.getElementById("toggle-password");
        const pw = document.getElementById("password-field");
        btn.addEventListener("click", () => {
            const icon = btn.querySelector("i");
            if (pw.type === "password") {
                pw.type = "text";
                icon.classList.replace("bi-eye", "bi-eye-slash");
            } else {
                pw.type = "password";
                icon.classList.replace("bi-eye-slash", "bi-eye");
            }
        });
    });
</script>