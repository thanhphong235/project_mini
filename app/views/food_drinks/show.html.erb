<div class="container mt-3">

    <!-- Flash messages -->
    <%= turbo_frame_tag "flash_messages" do %>
    <%= render "shared/flash" %>
    <% end %>

    <!-- Card chi tiết món ăn -->
    <div class="card shadow-sm p-3 mb-3">

        <h2><%= @food_drink.name %></h2>

        <% if @food_drink.image.attached? %>
        <%= image_tag @food_drink.image, class: "img-fluid mb-3" %>
        <% else %>
        <div class="bg-secondary text-white d-flex align-items-center justify-content-center mb-3" style="height: 250px;">
            Không có ảnh
        </div>
        <% end %>

        <p><strong>Giá:</strong> <%= number_to_currency(@food_drink.price, unit: "₫") %></p>
        <p><strong>Danh mục:</strong> <%= @food_drink.category&.name || "Không có" %></p>
        <p><strong>Mô tả:</strong> <%= @food_drink.description.presence || "Chưa có mô tả" %></p>

        <div class="mb-3 d-flex gap-2">
            <% if @food_drink.stock > 0 && user_signed_in? %>
            <%= button_to "Thêm vào giỏ", cart_items_path,
              method: :post,
              params: { food_drink_id: @food_drink.id },
              form: { data: { turbo: true } },
              class: "btn btn-sm btn-outline-success" %>
            <% elsif @food_drink.stock > 0 %>
            <%= link_to "Đăng nhập để mua", new_user_session_path, class: "btn btn-sm btn-outline-warning" %>
            <% else %>
            <button class="btn btn-sm btn-outline-secondary" disabled>Hết hàng</button>
            <% end %>

            <%= link_to "Quay lại", food_drinks_path, class: "btn btn-sm btn-secondary" %>
        </div>

        <hr>

        <!-- Form đánh giá user -->
        <% if user_signed_in? %>
        <h5>Đánh giá của bạn</h5>
        <% user_rating = @food_drink.ratings.find_or_initialize_by(user: current_user) %>
        <%= render "ratings/form", rating: user_rating, food_drink: @food_drink %>
        <% else %>
        <p><%= link_to "Đăng nhập", new_user_session_path %> để đánh giá sản phẩm.</p>
        <% end %>

        <!-- Danh sách đánh giá -->
        <h5>Đánh giá sản phẩm</h5>
        <%= turbo_frame_tag "ratings_list" do %>
        <%= render "ratings/list", ratings: @food_drink.ratings.includes(:user) %>
        <% end %>

        <hr>

        <!-- Chia sẻ -->
        <h5>Chia sẻ</h5>
        <a href="https://www.facebook.com/sharer/sharer.php?u=<%= request.original_url %>" target="_blank" class="btn btn-sm btn-primary me-1">Facebook</a>
        <a href="https://twitter.com/intent/tweet?url=<%= request.original_url %>" target="_blank" class="btn btn-sm btn-info me-1">Twitter</a>

    </div>
</div>