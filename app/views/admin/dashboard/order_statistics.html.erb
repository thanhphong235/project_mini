<div class="order-statistics py-4 px-4">

    <!-- HEADER -->
    <div class="stats-header d-flex justify-content-between align-items-center mb-4">
        <h1 class="page-title text-center flex-grow-1 mb-0 fw-bold">
            Th·ªëng k√™ ƒë∆°n h√†ng ‚Äî <%= @month %>/<%= @year %>
        </h1>
        <div style="width:140px;"></div>
    </div>

    <!-- ACTION BAR -->
    <div class="action-bar d-flex justify-content-between align-items-center flex-wrap gap-3 mb-4">
        <%= button_to "üì© G·ª≠i b√°o c√°o qua email",
        admin_send_monthly_report_path(month: @month, year: @year),
        method: :post,
        class: "btn btn-success fw-semibold shadow-sm",
        data: { confirm: "G·ª≠i b√°o c√°o th·ªëng k√™ th√°ng n√†y qua email?" } %>

        <%= form_with url: admin_order_statistics_path,
          method: :get, local: true,
          class: "filter-form d-flex gap-3 align-items-center flex-wrap p-3 rounded-3 shadow-sm" do %>

        <div class="d-flex align-items-center gap-2">
            <label class="fw-semibold">Th√°ng:</label>
            <%= select_tag :month, options_for_select(1..12, @month), class: "form-select form-dark" %>
        </div>

        <div class="d-flex align-items-center gap-2">
            <label class="fw-semibold">NƒÉm:</label>
            <%= select_tag :year,
            options_for_select((2023..Time.current.year).to_a.reverse, @year),
            class: "form-select form-dark" %>
        </div>

        <%= submit_tag "Xem", class: "btn btn-primary fw-semibold" %>
        <% end %>
    </div>

    <!-- SUMMARY -->
    <div class="summary d-flex flex-wrap gap-3 mb-4">
        <div class="summary-card flex-grow-1 shadow-sm">
            <div class="label">T·ªïng s·ªë ƒë∆°n</div>
            <div class="value"><%= @total_orders %></div>
        </div>

        <div class="summary-card flex-grow-1 shadow-sm">
            <div class="label">T·ªïng doanh thu</div>
            <div class="value text-success">
                <%= number_to_currency(@total_revenue, unit: "‚Ç´") %>
            </div>
        </div>
    </div>

    <!-- TABLE -->
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle text-center mb-0 custom-table">
            <thead>
                <tr>
                    <th class="first-col">#</th>
                    <th class="text-start">Ng∆∞·ªùi ƒë·∫∑t</th>
                    <th>T·ªïng ti·ªÅn</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Ng√†y t·∫°o</th>
                </tr>
            </thead>
            <tbody>
                <% @orders.each_with_index do |order, index| %>
                <tr>
                    <td class="fw-semibold first-col"> <%= index + 1 %> </td>
                    <td class="text-start"><%= order.user&.name || order.user&.email || "N/A" %></td>
                    <td class="value-cell"><%= number_to_currency(order.total_price, unit: "‚Ç´") %></td>
                    <td><%= render "admin/orders/status_badge", order: order %></td>
                    <td><%= order.created_at.strftime("%d/%m/%Y %H:%M") %></td>
                </tr>
                <% end %>
            </tbody>
        </table>
    </div>

</div>

<style>
    /* =========================
   CONTAINER
========================= */
    .order-statistics {
        width: 100%;
        background: #1c1c1c;
        padding: 2rem;
        margin: 0;
        border-radius: 0;
    }

    /* =========================
   ACTION BAR
========================= */
    .filter-form {
        background: #222;
        border: 1px solid #333;
    }

    /* =========================
   SUMMARY CARDS
========================= */
    .summary-card {
        background: #181818;
        padding: 1.2rem 1.5rem;
        border-radius: 14px;
        min-width: 220px;
    }

    /* =========================
   TABLE
========================= */
    .table-responsive {
        margin-top: 1rem;
        background: transparent !important;
        border: none !important;
    }

    .custom-table {
        width: 100%;
        table-layout: fixed;
        /* √âp c√°c c·ªôt ƒë·ªÅu nhau */
        border: 2px solid #222 !important;
        background: #1a1a1a !important;
        border-radius: 0 !important;
    }

    .custom-table th,
    .custom-table td {
        width: 20%;
        /* 5 c·ªôt ‚Üí ƒë·ªÅu nhau */
        border: none !important;
        color: #e6e6e6 !important;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .custom-table thead th {
        background: #111 !important;
        font-weight: 700;
    }

    /* C·ªôt t√™n ng∆∞·ªùi cƒÉn tr√°i */
    .custom-table td.text-start,
    .custom-table th.text-start {
        text-align: left;
    }

    /* C·ªôt th·ª© t·ª± s√°t b√™n tr√°i */
    .custom-table th.first-col,
    .custom-table td.first-col {
        padding-left: 0.5rem;
        /* s√°t tr√°i, gi·∫£m padding m·∫∑c ƒë·ªãnh */
        text-align: left;
        width: 20%;
    }

    /* C·ªôt ti·ªÅn cƒÉn ph·∫£i */
    .value-cell {
        text-align: right;
        font-variant-numeric: tabular-nums;
        font-weight: 600;
    }

    /* ============================================
   üìå FIX VI·ªÄN TR·∫ÆNG QUANH B·∫¢NG (ƒëo·∫°n c·∫ßn th√™m)
   ============================================ */
    .table,
    .table-bordered,
    .table-bordered> :not(caption)>*>* {
        border-color: #333 !important;
    }

    .table {
        background: #1a1a1a !important;
        border: 2px solid #222 !important;
        /* XO√Å vi·ªÅn tr·∫Øng */
    }

    .table td,
    .table th {
        background: #1a1a1a !important;
        color: #e6e6e6 !important;
    }

    /* Ph·∫ßn bao b·∫£ng (table-responsive) */
    .table-responsive {
        background: transparent !important;
        border: none !important;
    }

    .table-responsive .table {
        border-radius: 0 !important;
    }
</style>