<div class="order-statistics container mt-4 p-4">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <%= link_to "Quay l·∫°i", admin_dashboard_path, class: "btn btn-outline-secondary" %>
        <h1 class="text-center flex-grow-1 mb-0">
            Th·ªëng k√™ ƒë∆°n h√†ng th√°ng <%= @month %>/<%= @year %>
        </h1>
        <div style="width:120px;"></div>
    </div>

    <!-- Form ch·ªçn th√°ng/nƒÉm v√† g·ª≠i email -->
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">

        <div>
            <%= button_to "üì© G·ª≠i th·ªëng k√™ qua email",
          admin_send_monthly_report_path(month: @month, year: @year),
          method: :post,
          class: "btn btn-success",
          data: { confirm: "B·∫°n c√≥ ch·∫Øc mu·ªën g·ª≠i b√°o c√°o th√°ng n√†y qua email?" } %>
        </div>

        <div>
            <%= form_with url: admin_order_statistics_path, method: :get, local: true, class: "d-flex gap-3 flex-wrap align-items-center" do %>
            <div class="d-flex align-items-center gap-2">
                <label>Th√°ng:</label>
                <%= select_tag :month, options_for_select(1..12, @month), class: "form-select" %>
            </div>
            <div class="d-flex align-items-center gap-2">
                <label>NƒÉm:</label>
                <%= select_tag :year, options_for_select((2023..Time.current.year).to_a.reverse, @year), class: "form-select" %>
            </div>
            <%= submit_tag "Xem", class: "btn btn-primary" %>
            <% end %>
        </div>

    </div>

    <!-- Th·ªëng k√™ nhanh -->
    <div class="mb-4 d-flex flex-wrap gap-3">
        <div class="summary-card">
            T·ªïng s·ªë ƒë∆°n trong th√°ng: <strong><%= @total_orders %></strong>
        </div>
        <div class="summary-card">
            T·ªïng doanh thu: <strong><%= number_to_currency(@total_revenue, unit: "‚Ç´") %></strong>
        </div>
    </div>

    <!-- B·∫£ng hi·ªÉn th·ªã ƒë∆°n -->
    <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle text-center">
            <thead class="table-light">
                <tr>
                    <th>#</th>
                    <th>Ng∆∞·ªùi ƒë·∫∑t</th>
                    <th>T·ªïng ti·ªÅn</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Ng√†y t·∫°o</th>
                </tr>
            </thead>
            <tbody>
                <% @orders.each_with_index do |order, index| %>
                <tr>
                    <td><%= index + 1 %></td>
                    <td><%= order.user&.name || order.user&.email || "N/A" %></td>
                    <td style="font-variant-numeric: tabular-nums;">
                        <%= number_to_currency(order.total_price, unit: "‚Ç´") %>
                    </td>
                    <td>
                        <%= render "admin/orders/status_badge", order: order %>
                    </td>
                    <td><%= order.created_at.strftime("%d/%m/%Y %H:%M") %></td>
                </tr>
                <% end %>
            </tbody>
        </table>
    </div>

</div>

<!-- CSS -->
<style>
    .order-statistics {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
    }

    .summary-card {
        background: #f5f7ff;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        font-weight: 600;
        flex: 1 1 200px;
        text-align: center;
    }

    .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.9rem;
        color: #fff;
    }

    .status-badge.pending {
        background: #ffc107;
        color: #212529;
    }

    .status-badge.confirmed {
        background: #0d6efd;
    }

    .status-badge.delivering {
        background: #17a2b8;
    }

    .status-badge.completed {
        background: #198754;
    }

    .status-badge.cancelled {
        background: #dc3545;
    }

    .table-responsive table th,
    .table-responsive table td {
        vertical-align: middle;
    }

    @media(max-width:768px) {
        .order-statistics table {
            font-size: 0.85rem;
        }

        .order-statistics table th,
        .order-statistics table td {
            padding: 0.4rem;
        }
    }
</style>