<!-- Header -->
<div class="page-header d-flex justify-content-between align-items-center mb-4">
    <%= link_to "Quay lại", admin_dashboard_path, class: "btn btn-outline-secondary px-3" %>

    <h1 class="page-title fw-semibold text-center flex-grow-1 mb-0">
        Danh sách Đơn hàng
    </h1>

    <!-- Nút giả để cân layout -->
    <div class="header-placeholder" style="width: 90px;"></div>
</div>

<!-- Flash messages -->
<%= turbo_frame_tag "flash_messages" do %>
<%= render "shared/flash_messages" %>
<% end %>

<!-- Orders Table -->
<div class="orders-wrapper table-responsive shadow-sm rounded-3 p-3 bg-white">
    <%= turbo_frame_tag "orders_table" do %>
    <table class="table table-hover align-middle orders-table">
        <thead class="table-dark text-center">
            <tr>
                <th>#</th>
                <th>Người đặt</th>
                <th>Tổng tiền</th>
                <th>Trạng thái</th>
                <th>Ngày đặt</th>
                <th>Hành động</th>
            </tr>
        </thead>

        <tbody class="text-center">
            <% @orders.each_with_index do |order, index| %>
            <tr id="order_<%= order.id %>">
                <td class="fw-bold"><%= index %></td>

                <td>
                    <%= order.user&.name || order.user&.email || "N/A" %>
                </td>

                <!-- Giá tiền đẹp - thẳng cột -->
                <td class=" price-cell">
                    <span class="price-number"><%= number_with_delimiter(order.total_price) %></span>
                    <span class="price-unit">₫</span>
                </td>

                <td>
                    <%= turbo_frame_tag "order_status_#{order.id}" do %>
                    <div class="d-flex justify-content-center">
                        <%= render "status_badge", order: order %>
                    </div>
                    <% end %>
                </td>

                <td><%= order.created_at.strftime("%d/%m/%Y %H:%M") %></td>

                <td>
                    <div class="d-flex justify-content-center gap-2">
                        <%= link_to "Xem", admin_order_path(order),
                            class: "btn btn-sm btn-outline-primary px-3",
                            data: { turbo: false } %>

                        <% if order.status == "pending" %>
                        <%= button_to "Xóa", admin_order_path(order),
                            method: :delete,
                            data: { turbo_confirm: "Bạn có chắc chắn muốn xóa đơn hàng này?" },
                            class: "btn btn-sm btn-outline-danger px-3" %>
                        <% else %>
                        <button class="btn btn-sm btn-outline-secondary px-3" disabled>Không thể xoá</button>
                        <% end %>
                    </div>
                </td>
            </tr>
            <% end %>
        </tbody>
    </table>
    <% end %>
</div>

<style>
    /* .page-title {
        font-size: 1.6rem;
    } */

    .orders-wrapper {
        border-radius: 12px;
    }

    .price-cell {
        font-variant-numeric: tabular-nums;
        white-space: nowrap;
    }

    .price-number {
        font-weight: 600;
        margin-right: 2px;
    }

    .price-unit {
        opacity: 0.75;
    }

    /* Căn lại nút trong bảng cho đẹp */
    .table .btn {
        min-width: 70px;
    }

    /* Header Placeholder để cân nút trái-phải */
    .header-placeholder {
        width: 90px;
    }
</style>