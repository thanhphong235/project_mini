<!-- app/views/food_drinks/index.html.erb -->

<div class="container mt-3">

    <!-- Header + Filter cố định -->
    <div class="position-sticky" style="top: 0; z-index: 1020; background-color: white;">
        <h1 class="p-3 mb-0 border-bottom">Danh sách Món ăn & Thức uống</h1>

        <!-- Filter / Phân loại -->
        <div class="d-flex flex-wrap gap-2 p-2 border-bottom">

            <!-- Xem tất cả -->
            <%= link_to "Tất cả", food_drinks_path, class: "btn btn-sm btn-outline-dark" %>

            <!-- Filter theo category -->
            <% Category.all.each do |cat| %>
            <%= link_to cat.name, food_drinks_path(category_id: cat.id), class: "btn btn-sm btn-outline-primary" %>
            <% end %>

            <!-- Filter theo chữ cái -->
            <% ("A".."Z").each do |letter| %>
            <% link_params = {
          category_id: params[:category_id],
          kind: params[:kind],
          min_price: params[:min_price],
          max_price: params[:max_price],
          min_rating: params[:min_rating],
          letter: letter
        }.compact %>
            <%= link_to letter, food_drinks_path(link_params), class: "btn btn-sm btn-outline-info" %>
            <% end %>

            <!-- Filter giá & rating -->
            <%= form_with url: food_drinks_path, method: :get, local: true, class: "d-flex gap-1" do |f| %>
            <%= f.number_field :min_price, placeholder: "Giá min", class: "form-control form-control-sm" %>
            <%= f.number_field :max_price, placeholder: "Giá max", class: "form-control form-control-sm" %>
            <%= f.number_field :min_rating, placeholder: "Đánh giá min", class: "form-control form-control-sm", step: 0.1 %>
            <%= f.submit "Lọc", class: "btn btn-sm btn-primary" %>
            <% end %>

        </div>
    </div>

    <!-- Danh sách món ăn -->
    <div class="row mt-3">
        <% @food_drinks.each do |fd| %>
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm h-100">

                <!-- Hình ảnh -->
                <% if fd.image.attached? %>
                <%= image_tag fd.image, class: "card-img-top", style: "height: 200px; object-fit: cover;" %>
                <% else %>
                <div class="bg-secondary text-white d-flex align-items-center justify-content-center" style="height: 200px;">
                    Không có ảnh
                </div>
                <% end %>

                <div class="card-body d-flex flex-column">

                    <h5 class="card-title"><%= link_to fd.name, food_drink_path(fd) %></h5>
                    <p class="card-text"><strong>Giá:</strong> <%= number_to_currency(fd.price, unit: "₫") %></p>
                    <p class="card-text"><strong>Danh mục:</strong> <%= fd.category&.name || "Không có" %></p>

                    <!-- Stock hiển thị với Turbo Frame -->
                    <p class="card-text">
                        <strong>Số lượng còn:</strong>
                        <%= turbo_frame_tag "food_drink_#{fd.id}_stock" do %>
                        <%= fd.stock > 0 ? fd.stock : "Hết hàng" %>
                        <% end %>
                    </p>

                    <!-- Nút hành động -->
                    <div class="mt-auto d-flex gap-1">
                        <%= link_to "Xem chi tiết", food_drink_path(fd), class: "btn btn-sm btn-outline-primary" %>

                        <%= turbo_frame_tag "food_drink_#{fd.id}_button" do %>
                        <% if fd.stock > 0 %>
                        <%= button_to "Thêm vào giỏ",
                        cart_items_path,
                        method: :post,
                        params: { food_drink_id: fd.id },
                        form: { data: { turbo_stream: true, turbo_frame: "_top" } },
                        class: "btn btn-sm btn-outline-success" %>
                        <% else %>
                        <button class="btn btn-sm btn-outline-secondary" disabled>Hết hàng</button>
                        <% end %>
                        <% end %>
                    </div>

                </div>
            </div>
        </div>
        <% end %>
    </div>

</div>