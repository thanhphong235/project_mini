<h1>Quản lý Món ăn & Thức uống</h1>

<div class="mb-3">
    <%= link_to "Quay lại", admin_dashboard_path, class: "btn btn-secondary" %>
    <%= link_to "Tất cả", admin_food_drinks_path, class: "btn btn-secondary me-2" %>

    <% Category.all.each do |category| %>
    <%= link_to category.name, admin_food_drinks_path(category_id: category.id), class: "btn btn-primary me-2" %>
    <% end %>
</div>

<div class="mb-3">
    <%= link_to "Thêm mới", new_admin_food_drink_path, class: "btn btn-success me-2" %>
</div>

<table class="table table-striped align-middle">
    <thead>
        <tr>
            <th>#</th>
            <th>Tên</th>
            <th>Giá</th>
            <th>Category</th>
            <th>Số lượng</th>
            <th>Mô tả</th>
            <th>Ảnh</th>
            <th>Hành động</th>
        </tr>
    </thead>
    <tbody>
        <% @food_drinks.each_with_index do |fd, index| %>
        <tr id="food_drink_<%= fd.id %>">
            <td><%= index + 1 %></td>
            <td><%= fd.name %></td>
            <td><%= number_to_currency(fd.price, unit: "₫") %></td>
            <td><%= fd.category&.name || "Chưa phân loại" %></td>

            <!-- Cập nhật số lượng inline -->
            <td>
                <%= form_with model: [:admin, fd], method: :patch, local: true do |f| %>
                <div class="d-flex">
                    <%= f.number_field :stock, value: fd.stock, class: "form-control form-control-sm me-1", min: 0 %>
                    <%= f.submit "Cập nhật", class: "btn btn-sm btn-primary" %>
                </div>
                <% end %>
            </td>



            <td><%= truncate(fd.description, length: 50) %></td>

            <td>
                <% if fd.image.attached? %>
                <%= image_tag fd.image, width: 80, height: 80, alt: fd.name %>
                <% else %>
                Không có ảnh
                <% end %>
            </td>

            <td>
                <%= link_to "Sửa", edit_admin_food_drink_path(fd), class: "btn btn-warning btn-sm me-1" %>
                <%= link_to "Xóa", admin_food_drink_path(fd),
    data: { turbo_method: :delete, turbo_confirm: fd.order_items.any? ? 
        "⚠️ Món ăn này đang có đơn hàng. Bạn chắc chắn muốn xoá?" : 
        "Bạn có chắc chắn muốn xoá món ăn/thức uống này?" },
    class: "btn btn-danger btn-sm" %>


            </td>
        </tr>
        <% end %>
    </tbody>
</table>